<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Editor | Nuvabase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .data-grid th {
            @apply px-4 py-3 text-[10px] font-black text-[#484f58] uppercase tracking-widest border-b border-[#30363d] bg-[#0d1117]/50 whitespace-nowrap;
        }
        .data-grid td {
            @apply px-4 py-3 text-sm text-[#c9d1d9] border-b border-[#21262d] whitespace-nowrap;
        }
        .data-grid tr:hover td {
            @apply bg-[#1c2128];
        }
    </style>
</head>
<body class="bg-[#0d1117] text-[#e6edf3] font-['Inter']">
    <div id="layout-root" class="flex min-h-screen">
        <div id="sidebar-target"></div>
        <div class="flex-1 flex flex-col min-w-0">
            <div id="navbar-target"></div>
            
            <main class="p-8 lg:p-12 overflow-y-auto custom-scrollbar animate-fadeIn w-full max-w-7xl mx-auto">
                <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-10">
                    <div class="space-y-1">
                        <div class="flex items-center gap-2">
                            <h1 class="text-3xl font-black text-white">Table Editor</h1>
                            <div class="flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                                <div class="w-1 h-1 bg-emerald-500 rounded-full animate-pulse"></div>
                                <span class="text-[9px] font-black text-emerald-500 uppercase">RLS Active</span>
                            </div>
                        </div>
                        <p class="text-[#8b949e] text-sm max-w-xl">
                            Direct management for <span class="text-white font-semibold italic">Production</span> shards. 
                            Kernel-level isolation ensures you only see data belonging to your current workspace.
                        </p>
                    </div>
                    
                    <div class="flex items-center gap-3 w-full md:w-auto">
                        <div class="relative flex-1 md:flex-initial">
                            <select id="table-selector" class="w-full appearance-none bg-[#1c2128] border border-[#30363d] text-white rounded-xl px-4 py-2.5 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-emerald-500/50 pr-10">
                                <option value="users">users</option>
                                <option value="followups">followups</option>
                                <option value="daily_activity">daily_activity</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-[#484f58]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </div>
                        <button id="add-row-btn" class="bg-emerald-500 hover:bg-emerald-400 text-black font-bold px-6 py-2.5 rounded-xl text-sm transition-all shadow-lg shadow-emerald-500/20 active:scale-95 whitespace-nowrap">
                            Insert Row
                        </button>
                    </div>
                </header>

                <div class="sb-card relative overflow-hidden">
                    <div id="loading-overlay" class="hidden absolute inset-0 bg-[#0d1117]/60 backdrop-blur-[1px] z-10 flex items-center justify-center">
                        <div class="w-6 h-6 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"></div>
                    </div>
                    
                    <div class="overflow-x-auto min-h-[400px]">
                        <table class="data-grid w-full text-left">
                            <thead id="table-head"></thead>
                            <tbody id="table-body"></tbody>
                        </table>
                        <div id="empty-state" class="hidden py-24 flex flex-col items-center justify-center text-[#484f58]">
                            <svg class="w-12 h-12 mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>
                            <span class="text-[10px] font-black uppercase tracking-widest">No rows found in this shard</span>
                        </div>
                    </div>
                </div>
                
                <footer class="mt-6 flex justify-between items-center text-[10px] text-[#484f58] font-black uppercase tracking-widest px-2">
                    <div class="flex items-center gap-4">
                        <span>Isolation: Kernel_RLS_Enforced</span>
                        <div class="h-3 w-px bg-[#30363d]"></div>
                        <span id="row-count">0 rows</span>
                    </div>
                    <div class="flex gap-4">
                        <button class="hover:text-emerald-500 transition-colors" onclick="alert('Exporting sanitized dataset...')">Export CSV</button>
                        <button class="hover:text-emerald-500 transition-colors" onclick="window.tables.fetchData()">Refresh</button>
                    </div>
                </footer>
            </main>
        </div>
    </div>

    <!-- Modal for Add/Edit -->
    <div id="row-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="document.getElementById('row-modal').classList.add('hidden')"></div>
        <div class="relative bg-[#1c2128] border border-[#30363d] w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-slideUp">
            <div class="p-6 border-b border-[#30363d] flex justify-between items-center bg-[#0d1117]/30">
                <h3 id="modal-title" class="text-sm font-black uppercase tracking-widest text-white">Edit Row</h3>
                <button onclick="document.getElementById('row-modal').classList.add('hidden')" class="text-[#484f58] hover:text-white transition-colors">âœ•</button>
            </div>
            <form id="row-form" class="p-8 space-y-6">
                <div id="form-fields" class="space-y-4 max-h-[400px] overflow-y-auto px-1 custom-scrollbar">
                    <!-- Dynamic form fields -->
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="document.getElementById('row-modal').classList.add('hidden')" class="flex-1 bg-[#30363d] hover:bg-[#484f58] text-white font-bold py-3 rounded-xl text-xs transition-colors">Cancel</button>
                    <button type="submit" class="flex-1 bg-emerald-500 hover:bg-emerald-400 text-black font-bold py-3 rounded-xl text-xs transition-all shadow-lg shadow-emerald-500/10">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { auth } from './js/auth.js';
        import { ui } from './js/ui.js';
        import { tables } from './js/tables.js';

        if (!auth.isAuthenticated()) window.location.href = 'index.html';
        ui.init('tables');
        tables.init();
    </script>
</body>
</html>